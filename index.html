<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- NUCLEAR CACHE PREVENTION -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Taskify Smart Pantry - Kitchen Management Made Simple</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css?v=11">
</head>
<body>
    <!-- ============================================ -->
    <!-- AUTHENTICATION SCREEN (New) -->
    <!-- ============================================ -->
    <div id="auth-screen" style="display: block;">
        <div class="auth-container">
            <div class="auth-header">
                <h1>ü•ï Taskify Smart Pantry</h1>
                <p>Kitchen management made simple</p>
            </div>

            <!-- Login Form -->
            <div id="login-form" class="auth-form">
                <h2>Welcome Back</h2>
                <div class="form-group">
                    <label for="login-email">Email</label>
                    <input 
                        type="email" 
                        id="login-email" 
                        placeholder="your@email.com"
                        autocomplete="email"
                    >
                </div>
                <div class="form-group">
                    <label for="login-password">Password</label>
                    <input 
                        type="password" 
                        id="login-password" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        autocomplete="current-password"
                    >
                </div>
                <button class="btn-auth-primary" onclick="handleLogin()">Sign In</button>
                <p class="auth-switch">
                    Don't have an account? 
                    <a href="#" onclick="showSignupForm(); return false;">Sign up</a>
                </p>
            </div>

            <!-- Signup Form -->
            <div id="signup-form" class="auth-form" style="display: none;">
                <h2>Create Account</h2>
                <div class="form-group">
                    <label for="signup-name">Display Name</label>
                    <input 
                        type="text" 
                        id="signup-name" 
                        placeholder="Your Name"
                        autocomplete="name"
                    >
                </div>
                <div class="form-group">
                    <label for="signup-email">Email</label>
                    <input 
                        type="email" 
                        id="signup-email" 
                        placeholder="your@email.com"
                        autocomplete="email"
                    >
                </div>
                <div class="form-group">
                    <label for="signup-password">Password</label>
                    <input 
                        type="password" 
                        id="signup-password" 
                        placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                        autocomplete="new-password"
                    >
                    <small>At least 6 characters</small>
                </div>
                <button class="btn-auth-primary" onclick="handleSignup()">Create Account</button>
                <p class="auth-switch">
                    Already have an account? 
                    <a href="#" onclick="showLoginForm(); return false;">Sign in</a>
                </p>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MAIN APP CONTENT (Wrapped) -->
    <!-- ============================================ -->
    <div id="app-content" style="display: none;">
        <!-- Navigation Overlay -->
        <div class="nav-overlay" id="nav-overlay" onclick="closeNav()"></div>

        <div class="container">
            <header>
                <div class="header-content">
                    <span class="header-logo">ü•ï</span>
                    <h1>Taskify Smart Pantry</h1>
                </div>
                <button class="hamburger-menu" id="hamburger-btn" onclick="toggleNav()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </header>

            <!-- Greeting Banner -->
            <div class="greeting-banner" id="greeting-banner">
                <span id="greeting-text">Good Evening</span>
                <span id="current-datetime">Monday, 12:00 PM, December 30th, 2024</span>
            </div>

            <!-- Slide-out Navigation -->
            <nav class="main-nav" id="main-nav">
                <div class="nav-header">
                    <h2>Menu</h2>
                </div>
                <button class="nav-btn active" data-section="dashboard" onclick="navigateToSection('dashboard')">
                    <span class="nav-item-icon">üè†</span>
                    <span>Dashboard</span>
                </button>
                <button class="nav-btn" data-section="ingredients" onclick="navigateToSection('ingredients')">
                    <span class="nav-item-icon">ü•ï</span>
                    <span>Pantry</span>
                </button>
                <button class="nav-btn" data-section="recipes" onclick="navigateToSection('recipes')">
                    <span class="nav-item-icon">üìñ</span>
                    <span>Recipes</span>
                </button>
                <button class="nav-btn" data-section="shopping" onclick="navigateToSection('shopping')">
                    <span class="nav-item-icon">üõí</span>
                    <span>Shopping</span>
                </button>
                <button class="nav-btn" data-section="meal-plan" onclick="navigateToSection('meal-plan')">
                    <span class="nav-item-icon">üìÖ</span>
                    <span>Meal Plan</span>
                </button>
                <button class="nav-btn" data-section="settings" onclick="navigateToSection('settings')">
                    <span class="nav-item-icon">‚öôÔ∏è</span>
                    <span>Settings</span>
                </button>
            </nav>

            <!-- Dashboard Section -->
            <section id="dashboard" class="section active">
                <div class="dashboard-welcome">
                    <h2>Dashboard</h2>
                    <p class="dashboard-subtitle">Overview of your kitchen</p>
                </div>

                <!-- Expiring Items Alert -->
                <div id="expiring-alert" class="dashboard-alert" style="display: none;">
                    <div class="alert-content">
                        <h3>Items Expiring Soon</h3>
                        <p id="expiring-alert-text"></p>
                    </div>
                </div>

                <!-- Today's Meal Plan -->
                <div id="today-meal-plan" class="today-meals-section" style="display: none;">
                    <h3>Today's Meals</h3>
                    <div id="today-meals-content"></div>
                </div>

                <div class="dashboard-grid">
                    <div class="dashboard-card" data-navigate="ingredients">
                        <h3><span class="card-icon">üè∫</span> Pantry</h3>
                        <p class="card-stat" id="dashboard-ingredients-count">0 items</p>
                        <p class="card-stat-secondary" id="dashboard-ingredients-secondary"></p>
                        <p class="card-description">Manage ingredients</p>
                    </div>

                    <div class="dashboard-card" data-navigate="recipes">
                        <h3><span class="card-icon">üìö</span> Recipes</h3>
                        <p class="card-stat" id="dashboard-recipes-count">0 recipes</p>
                        <p class="card-stat-secondary" id="dashboard-recipes-secondary"></p>
                        <p class="card-description">Browse collection</p>
                    </div>

                    <div class="dashboard-card" data-navigate="shopping">
                        <h3><span class="card-icon">üõí</span> Shopping</h3>
                        <p class="card-stat" id="dashboard-shopping-count">0 items</p>
                        <p class="card-stat-secondary" id="dashboard-shopping-secondary"></p>
                        <p class="card-description">Shopping list</p>
                    </div>

                    <div class="dashboard-card" data-navigate="meal-plan">
                        <h3><span class="card-icon">üìÖ</span> Meal Plan</h3>
                        <p class="card-stat" id="dashboard-meals-count">Plan your week</p>
                        <p class="card-stat-secondary" id="dashboard-meals-secondary"></p>
                        <p class="card-description">Weekly planning</p>
                    </div>
                </div>
            </section>

            <!-- Ingredients Section -->
            <section id="ingredients" class="section">
                <div class="section-header">
                    <h2>My Ingredients</h2>
                </div>

                <!-- Add/Edit Ingredient Form (Modal style) -->
                <!-- Add/Edit Ingredient Modal -->
                <div class="modal hidden" id="add-ingredient-form-container">
                    <div class="modal-content">
                        <span class="close-modal" id="close-ingredient-modal">&times;</span>
                        <h3 id="ingredient-form-title">Add New Ingredient</h3>
                        <div class="form-group">
                            <label>Ingredient Name</label>
                            <input type="text" id="ingredient-name" placeholder="e.g., Flour, Milk, Tomatoes" list="ingredient-names-list" />
                            <datalist id="ingredient-names-list"></datalist>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Quantity</label>
                                <input type="number" id="ingredient-quantity" placeholder="1" min="0.1" step="0.1" value="1" />
                            </div>
                            <div class="form-group">
                                <label>Unit</label>
                                <input type="text" id="ingredient-unit" placeholder="cups, lbs, etc." list="units-list" />
                                <datalist id="units-list"></datalist>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Storage Location</label>
                                <select id="ingredient-location">
                                    <!-- Will be populated from database -->
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Item Category</label>
                                <select id="ingredient-item-category">
                                    <option value="">-- Select Category --</option>
                                    <!-- Will be populated from database -->
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Expiration (optional)</label>
                            <input type="date" id="ingredient-expiration" />
                        </div>
                        <div class="form-actions">
                            <button id="add-ingredient-btn" class="primary-btn">Save Ingredient</button>
                            <button id="cancel-add-ingredient" class="secondary-btn">Cancel</button>
                        </div>
                    </div>
                </div>

                <!-- Search Bar -->
                <div class="ingredient-search-bar">
                    <input type="text" id="ingredient-search" placeholder="Search ingredients..." />
                </div>

                <!-- Ingredient Summary Boxes -->
                <div class="ingredient-summary-boxes">
                    <div class="summary-box">
                        <h4>Available</h4>
                        <p class="summary-count" id="available-count">0 ingredients</p>
                    </div>
                    <div class="summary-box">
                        <h4>Reserved</h4>
                        <p class="summary-count" id="reserved-count">0 ingredients</p>
                    </div>
                    <div class="summary-box expiring">
                        <h4>Expiring Soon</h4>
                        <p class="summary-count" id="expiring-count">0 ingredients</p>
                    </div>
                </div>

                <!-- Location Tabs (Dynamic from database) -->
                <div class="location-tabs" id="location-tabs">
                    <!-- Will be populated dynamically -->
                </div>

                <!-- Ingredients Grid (3 columns) -->
                <div class="ingredients-grid" id="ingredients-grid">
                    <!-- Will be populated dynamically -->
                </div>

                <!-- Floating Add Button -->
                <button class="floating-add-btn" id="floating-add-ingredient" title="Add Ingredient">
                    <span>+</span>
                </button>
            </section>

            <!-- Recipes Section -->
            <section id="recipes" class="section">
                <div class="section-header">
                    <h2>My Recipes</h2>
                </div>

                <!-- Search Bar with Filter Toggle -->
                <div class="recipe-search-bar">
                    <div class="search-input-wrapper">
                        <input type="text" id="recipe-search" placeholder="Search recipes..." />
                    </div>
                    <button class="filter-toggle-btn" id="recipe-filter-toggle" onclick="toggleRecipeFilters()">
                        <span class="filter-icon">‚öôÔ∏è</span>
                        <span class="filter-text">Filters</span>
                    </button>
                </div>

                <!-- Collapsible Filter Panel -->
                <div class="filter-panel" id="recipe-filter-panel" style="display: none;">
                    <div class="filter-panel-content">
                        <div class="filter-group">
                            <label class="filter-label">Category</label>
                            <div class="filter-buttons">
                                <button class="filter-chip active" data-category="all">All</button>
                                <button class="filter-chip" data-category="breakfast">Breakfast</button>
                                <button class="filter-chip" data-category="lunch">Lunch</button>
                                <button class="filter-chip" data-category="dinner">Dinner</button>
                                <button class="filter-chip" data-category="dessert">Dessert</button>
                                <button class="filter-chip" data-category="snack">Snack</button>
                            </div>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Show Favorites Only</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="favorites-toggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Recipe Columns Container -->
                <div class="recipe-columns-container">
                    <!-- Ready to Cook Column -->
                    <div class="recipe-column">
                        <div class="column-header ready">
                            <h3>Ready to Cook</h3>
                            <span class="recipe-count" id="ready-count">0</span>
                        </div>
                        <div class="column-recipes" id="ready-recipes"></div>
                    </div>

                    <!-- Expiring Soon Column -->
                    <div class="recipe-column">
                        <div class="column-header expiring">
                            <h3>Expiring Soon</h3>
                            <span class="recipe-count" id="expiring-count">0</span>
                        </div>
                        <div class="column-recipes" id="expiring-recipes"></div>
                    </div>

                    <!-- Missing Ingredients Column -->
                    <div class="recipe-column">
                        <div class="column-header missing">
                            <h3>Missing Ingredients</h3>
                            <span class="recipe-count" id="missing-count">0</span>
                        </div>
                        <div class="column-recipes" id="missing-recipes"></div>
                    </div>
                </div>

                <!-- Add Recipe Form (Initially Hidden) -->
                <div id="add-recipe-form" class="modal hidden">
                    <div class="modal-content">
                        <span class="close-modal">&times;</span>
                        <h3 id="recipe-modal-title">Add New Recipe</h3>
                        <input type="text" id="recipe-name" placeholder="Recipe name" />

                        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Servings:</label>
                                <input type="number" id="recipe-servings" placeholder="Servings" min="1" value="4" style="width: 100%;" />
                            </div>
                            <div style="flex: 1;">
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Category:</label>
                                <select id="recipe-category" style="width: 100%; padding: 12px; border: 2px solid #e9ecef; border-radius: 8px;">
                                    <option value="">Select category</option>
                                    <option value="breakfast">Breakfast</option>
                                    <option value="lunch">Lunch</option>
                                    <option value="dinner">Dinner</option>
                                    <option value="dessert">Dessert</option>
                                    <option value="snack">Snack</option>
                                </select>
                            </div>
                        </div>

                        <input type="text" id="recipe-image" placeholder="Image URL (optional)" />
                        <textarea id="recipe-instructions" placeholder="Instructions (optional)" rows="4"></textarea>

                        <div class="recipe-ingredients-input">
                            <h4>Ingredients Required</h4>
                            <div id="recipe-ingredient-inputs">
                                <div class="recipe-ingredient-row">
                                    <input type="text" class="recipe-ing-name" placeholder="Ingredient" />
                                    <input type="number" class="recipe-ing-qty" placeholder="Qty" min="0.1" step="0.1" value="1" />
                                    <input type="text" class="recipe-ing-unit" placeholder="Unit" />
                                    <button type="button" class="remove-ing-btn">Remove</button>
                                </div>
                            </div>
                            <button type="button" id="add-recipe-ingredient-btn">+ Add Ingredient</button>
                        </div>

                        <button id="save-recipe-btn">Save Recipe</button>
                    </div>
                </div>

                <!-- Floating Add Button -->
                <button class="floating-add-btn" id="floating-add-recipe" title="Add Recipe">
                    <span>+</span>
                </button>
            </section>

            <!-- Shopping List Section -->
            <section id="shopping" class="section">
                <div class="section-header">
                    <h2>Shopping List</h2>
                </div>

                <!-- Filter Toggle Button -->
                <div class="shopping-header-bar">
                    <button class="filter-toggle-btn" id="shopping-filter-toggle" onclick="toggleShoppingFilters()">
                        <span class="filter-icon">‚öôÔ∏è</span>
                        <span class="filter-text">Category Filters</span>
                    </button>
                </div>

                <!-- Collapsible Category Filter Panel -->
                <div class="filter-panel" id="shopping-filter-panel" style="display: none;">
                    <div class="filter-panel-content">
                        <div class="filter-group">
                            <label class="filter-label">Category</label>
                            <div class="filter-buttons">
                                <button class="filter-chip active" data-category="all" onclick="filterShoppingByCategory('all')">All</button>
                                <button class="filter-chip" data-category="Produce" onclick="filterShoppingByCategory('Produce')">Produce</button>
                                <button class="filter-chip" data-category="Dairy" onclick="filterShoppingByCategory('Dairy')">Dairy</button>
                                <button class="filter-chip" data-category="Meat" onclick="filterShoppingByCategory('Meat')">Meat</button>
                                <button class="filter-chip" data-category="Pantry" onclick="filterShoppingByCategory('Pantry')">Pantry</button>
                                <button class="filter-chip" data-category="Frozen" onclick="filterShoppingByCategory('Frozen')">Frozen</button>
                                <button class="filter-chip" data-category="Bakery" onclick="filterShoppingByCategory('Bakery')">Bakery</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions Container -->
                <div class="shopping-actions-container">
                    <!-- Left Column: Quick Add -->
                    <div class="shopping-actions-left">
                        <button id="quick-add-common-items-btn" class="btn-action-large">Quick Add Common Items</button>
                    </div>

                    <!-- Right Column: Quick Actions -->
                    <div class="shopping-actions-right">
                        <div class="quick-actions-card">
                            <h3>Quick Actions</h3>
                            <div class="quick-actions-grid">
                                <button id="check-all-shopping-btn" class="btn-action">Check All</button>
                                <button id="send-to-pantry-btn" class="btn-action btn-action-primary">
                                    Send to Pantry
                                    <small>** Only works when items are checked **</small>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generation Actions -->
                <div class="shopping-generation-grid">
                    <button id="auto-generate-list-btn" class="btn-generation">Auto-Generate from Recipes</button>
                    <button id="generate-from-meal-plan-btn" class="btn-generation">Generate from Meal Plan</button>
                    <button id="print-shopping-list-btn" class="btn-generation">Print List</button>
                    <button id="clear-shopping-list-btn" class="btn-generation btn-danger">Clear List</button>
                </div>

                <!-- Shopping List Display -->
                <div id="shopping-list-by-category"></div>

                <!-- Floating Add Button -->
                <button class="floating-add-btn" id="floating-add-shopping" title="Add Item">
                    <span>+</span>
                </button>
            </section>

            <!-- Add Shopping Item Modal -->
            <div id="add-shopping-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close-modal" id="close-shopping-modal">&times;</span>
                    <h3>Add Shopping Item</h3>
                    <div class="form-group">
                        <label>Item Name</label>
                        <input type="text" id="shopping-item-name" placeholder="e.g., Milk, Bread" />
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Quantity</label>
                            <input type="number" id="shopping-item-qty" placeholder="1" min="0.1" step="0.1" value="1" />
                        </div>
                        <div class="form-group">
                            <label>Unit</label>
                            <input type="text" id="shopping-item-unit" placeholder="lbs, pcs" />
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <select id="shopping-item-category">
                            <!-- Will be populated from database -->
                        </select>
                    </div>
                    <div class="form-actions">
                        <button id="add-shopping-item-btn" class="primary-btn">Add to List</button>
                        <button id="cancel-add-shopping" class="secondary-btn">Cancel</button>
                    </div>
                </div>
            </div>

            <!-- Quick Add Common Items Modal -->
            <div id="quick-add-modal" class="modal hidden">
                <div class="modal-content">
                    <span class="close-modal" id="close-quick-add-modal">&times;</span>
                    <h3>Quick Add Common Items</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Click items to add them to your shopping list</p>
                    <div id="common-items-grid" class="common-items-grid">
                        <!-- Will be populated with common items -->
                    </div>
                </div>
            </div>

            <!-- Meal Plan Section -->
            <section id="meal-plan" class="section">
                <div class="section-header">
                    <h2>2-Week Meal Plan</h2>
                    <div class="header-actions">
                        <button class="btn-secondary" id="duplicate-week-btn">Duplicate Week</button>
                        <button class="btn-danger" id="clear-meal-plan">Clear Plan</button>
                    </div>
                </div>

                <!-- 2-Week Side-by-Side Grid -->
                <div class="two-week-container">
                    <div class="week-column">
                        <div class="week-column-header">
                            <h3>Week 1 (Current)</h3>
                        </div>
                        <div id="week1-days" class="week-days-grid">
                            <!-- Week 1 days will be generated -->
                        </div>
                    </div>

                    <div class="week-column">
                        <div class="week-column-header">
                            <h3>Week 2 (Next)</h3>
                        </div>
                        <div id="week2-days" class="week-days-grid">
                            <!-- Week 2 days will be generated -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Settings Section -->
            <section id="settings" class="section">
                <h2>Settings & Data Management</h2>

                <div class="settings-card">
                    <h3>Household Sharing</h3>
                    <p class="card-description">
                        Your pantry is shared with everyone in your household. Invite others to collaborate!
                    </p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 15px;">
                        <button onclick="showInviteModal()" class="btn-primary">Generate Invite Code</button>
                        <button onclick="showJoinModal()" class="btn-secondary">Join Another Household</button>
                    </div>
                </div>

                <!-- NEW: Manage Storage Locations -->
                <div class="settings-card">
                    <h3>Storage Locations</h3>
                    <p class="card-description">
                        Manage where you store your ingredients. Add custom locations like "Garage Freezer" or "Wine Fridge".
                    </p>
                    <div style="margin-top: 15px;">
                        <button class="btn-primary" id="add-location-btn">+ Add Location</button>
                    </div>
                    <div id="locations-list" style="margin-top: 15px;">
                        <!-- Locations will be populated here -->
                    </div>
                </div>

                <!-- NEW: Manage Categories -->
                <div class="settings-card">
                    <h3>Item Categories</h3>
                    <p class="card-description">
                        Organize your ingredients by type. Add custom categories like "Spices", "Baking", or "Asian Ingredients".
                    </p>
                    <div style="margin-top: 15px;">
                        <button class="btn-primary" id="add-category-btn">+ Add Category</button>
                    </div>
                    <div id="categories-list" style="margin-top: 15px;">
                        <!-- Categories will be populated here -->
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Data Backup & Restore</h3>
                    <p class="card-description">Export your data for backup or import from a previous backup.</p>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button id="export-data-btn" class="btn-success">Export All Data</button>
                        <label for="import-data-file" style="cursor: pointer; display: inline-block;">
                            <button type="button" id="import-trigger-btn" class="btn-primary">Import Data</button>
                            <input type="file" id="import-data-file" accept=".json" style="display: none;" />
                        </label>
                    </div>
                </div>

                <div class="settings-card">
                    <h3>Statistics</h3>
                    <div id="stats-display" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <!-- Stats will be populated here -->
                    </div>
                </div>

                <div class="settings-card">
                    <h3>About Taskify Smart Pantry</h3>
                    <p class="card-description">Version 3.0 - Supabase Edition</p>
                    <p class="card-description" style="margin-top: 10px;">Your complete kitchen management solution with real-time sync across all devices!</p>
                </div>

                <div class="settings-card">
                    <h3>Account Management</h3>
                    <p class="card-description">Sign out of your account</p>
                    <div style="margin-top: 15px;">
                        <button onclick="handleSignout()" class="btn-danger">Sign Out</button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Ingredient Deduction Selection Modal -->
    <div id="deduction-selection-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeDeductionModal()"></div>
        <div class="deduction-modal-content">
            <div class="deduction-modal-header">
                <h2>Choose Ingredient Locations</h2>
                <button class="close-modal-btn" onclick="closeDeductionModal()">&times;</button>
            </div>
            <p class="deduction-modal-subtitle">Some ingredients are available in multiple locations. Choose where to deduct from:</p>
            <div id="deduction-choices-container" class="deduction-choices"></div>
            <div class="deduction-modal-actions">
                <button class="btn-secondary" onclick="closeDeductionModal()">Cancel</button>
                <button class="btn-primary" onclick="confirmDeductions()">Confirm & Cook</button>
            </div>
        </div>
    </div>

    <!-- Recipe Detail Modal (Traditional Recipe Card) -->
    <div id="recipe-detail-modal" class="modal hidden">
        <div class="modal-overlay" onclick="closeRecipeDetailModal()"></div>
        <div class="traditional-recipe-card">
            <button class="close-traditional-modal" onclick="closeRecipeDetailModal()">&times;</button>

            <div id="modal-color-stripe" class="recipe-color-stripe"></div>

            <div class="traditional-card-header">
                <h2 id="modal-recipe-name" class="traditional-recipe-title">Recipe Name</h2>
                <div class="traditional-meta-row">
                    <span class="traditional-meta-item">
                        <span class="meta-icon">üìÇ</span>
                        <span id="modal-recipe-category">Category</span>
                    </span>
                    <span class="traditional-meta-item">
                        <span class="meta-icon">üçΩÔ∏è</span>
                        <span id="modal-recipe-servings">Serves 4</span>
                    </span>
                    <div class="servings-multiplier-control">
                        <label for="modal-servings-multiplier">Scale:</label>
                        <select id="modal-servings-multiplier">
                            <option value="0.5">¬Ωx</option>
                            <option value="1" selected>1x</option>
                            <option value="1.5">1.5x</option>
                            <option value="2">2x</option>
                            <option value="3">3x</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="modal-recipe-image-container" class="traditional-recipe-image"></div>

            <div class="wooden-divider"></div>

            <div class="traditional-card-body">
                <div class="traditional-section">
                    <h3 class="traditional-section-title">üçÑ Ingredients</h3>
                    <ul id="modal-ingredients-list" class="traditional-ingredients-list"></ul>
                </div>

                <div id="modal-instructions-section" class="traditional-section">
                    <h3 class="traditional-section-title">üìù Instructions</h3>
                    <p id="modal-recipe-instructions" class="traditional-instructions-text"></p>
                </div>

                <div id="modal-missing-section" class="traditional-section missing-ingredients-section">
                    <h3 class="traditional-section-title">‚ö†Ô∏è Missing Ingredients</h3>
                    <ul id="modal-missing-list" class="traditional-missing-list"></ul>
                    <button id="modal-add-missing-btn" class="btn-secondary" onclick="addMissingFromModal()">
                        Add to Shopping List
                    </button>
                </div>
            </div>

            <div class="wooden-divider"></div>

            <div class="traditional-card-actions">
                <button id="modal-cook-btn" class="btn-primary" onclick="cookFromModal()">
                    üç≥ Cook This Recipe
                </button>
                <button class="btn-secondary" onclick="editFromModal()">
                    ‚úèÔ∏è Edit Recipe
                </button>
                <button id="modal-favorite-btn" class="btn-favorite" onclick="toggleFavoriteFromModal()">
                    ‚≠ê Favorite
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Ingredient Modal -->
    <div id="edit-ingredient-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 400px;">
            <span class="close-edit-ingredient">&times;</span>
            <h3>Edit Ingredient</h3>
            <input type="text" id="edit-ing-name" placeholder="Ingredient name" />
            <input type="number" id="edit-ing-quantity" placeholder="Quantity" min="0.1" step="0.1" />
            <input type="text" id="edit-ing-unit" placeholder="Unit" />
            <select id="edit-ing-category">
                <option value="pantry">Pantry</option>
                <option value="fridge">Fridge</option>
                <option value="freezer">Freezer</option>
            </select>
            <input type="date" id="edit-ing-expiration" placeholder="Expiration (optional)" />
            <button id="save-ingredient-edit-btn">Save Changes</button>
        </div>
    </div>

    <!-- Send to Pantry Modal -->
    <div id="send-to-pantry-modal" class="modal hidden">
        <div class="modal-content" style="max-width: 500px;">
            <span class="close-modal" onclick="closeSendToPantryModal()">&times;</span>
            <h3>Send Items to Pantry</h3>
            <p style="color: var(--text-secondary); margin-bottom: 20px;">
                Set storage location and category for your purchased items
            </p>

            <div id="send-to-pantry-items-list">
                <!-- Will be populated with checked items -->
            </div>

            <div class="form-actions" style="margin-top: 20px;">
                <button id="confirm-send-to-pantry-btn" class="primary-btn">Send to Pantry</button>
                <button onclick="closeSendToPantryModal()" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- HOUSEHOLD MODALS (New) -->
    <!-- ============================================ -->

    <!-- Invite Modal -->
    <div id="invite-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="hideInviteModal()">&times;</span>
            <h2>Invite to Household</h2>
            <p>Share this code with someone to add them to your pantry:</p>
            <div class="invite-code-box">
                <code id="invite-code-display">LOADING...</code>
            </div>
            <button onclick="copyInviteCode()" class="btn-primary">Copy Code</button>
            <button onclick="hideInviteModal()" class="btn-secondary">Close</button>
            <p class="small-text">Code expires in 7 days</p>
        </div>
    </div>

    <!-- Join Household Modal -->
    <div id="join-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-modal" onclick="hideJoinModal()">&times;</span>
            <h2>Join Household</h2>
            <p>Enter an invite code to join a shared pantry:</p>
            <div class="form-group">
                <input 
                    type="text" 
                    id="join-code-input" 
                    placeholder="XXXXXXXX"
                    style="text-transform: uppercase; width: 100%;"
                >
            </div>
            <button onclick="handleJoinHousehold()" class="btn-primary">Join</button>
            <button onclick="hideJoinModal()" class="btn-secondary">Cancel</button>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- SCRIPTS (Order matters!) -->
    <!-- ============================================ -->

    <!-- Supabase Client Library - Load synchronously -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <!-- Supabase Configuration - Initialize client -->
    <script src="supabase-config.js?v=1767062000"></script>

    <!-- Authentication Functions -->
    <script src="auth.js?v=1767062000"></script>

    <!-- Database Functions -->
    <script src="db.js?v=1767062000"></script>

    <!-- Main Application -->
    <script src="app.js?v=1767062000"></script>
</body>
</html>
