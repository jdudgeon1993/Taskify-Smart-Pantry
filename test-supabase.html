<!DOCTYPE html>
<html>
<head>
    <title>Supabase Connection Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #0f0; }
        .success { color: #0f0; }
        .error { color: #f00; }
        .info { color: #ff0; }
        pre { background: #000; padding: 10px; border: 1px solid #333; }
    </style>
</head>
<body>
    <h1>üîç Supabase Diagnostic Test</h1>
    <div id="output"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        const output = document.getElementById('output');

        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
        }

        async function runDiagnostics() {
            log('Starting diagnostics...', 'info');
            log('');

            // Test 1: Check if Supabase library loaded
            log('Test 1: Checking if Supabase library loaded from CDN...', 'info');
            if (typeof window.supabase !== 'undefined') {
                log('‚úÖ Supabase library loaded successfully', 'success');
                log('Available methods: ' + Object.keys(window.supabase).join(', '), 'info');
            } else {
                log('‚ùå FAILED: Supabase library not found!', 'error');
                log('This means the CDN script did not load.', 'error');
                return;
            }
            log('');

            // Test 2: Initialize client
            log('Test 2: Initializing Supabase client...', 'info');
            const SUPABASE_URL = 'https://exojuwforrrtewccqjfu.supabase.co';
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImV4b2p1d2ZvcnJydGV3Y2NxamZ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY5NjYwNzcsImV4cCI6MjA4MjU0MjA3N30.ZE-vLmDg9y4FxLby3AEOGYyJcYLk0Tvazwl94CdzjUI';

            let supabase;
            try {
                supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                log('‚úÖ Client initialized', 'success');
            } catch (error) {
                log('‚ùå FAILED: ' + error.message, 'error');
                return;
            }
            log('');

            // Test 3: Check auth
            log('Test 3: Checking auth system...', 'info');
            try {
                const { data: { session }, error } = await supabase.auth.getSession();
                if (error) {
                    log('‚ö†Ô∏è  Auth error: ' + error.message, 'error');
                } else {
                    log('‚úÖ Auth system working', 'success');
                    log('Current session: ' + (session ? 'Logged in' : 'Not logged in'), 'info');
                }
            } catch (error) {
                log('‚ùå FAILED: ' + error.message, 'error');
            }
            log('');

            // Test 4: Check database connection
            log('Test 4: Checking database tables...', 'info');

            // Check households table
            try {
                const { data, error } = await supabase
                    .from('households')
                    .select('count')
                    .limit(1);

                if (error) {
                    log('‚ùå households table: ' + error.message, 'error');
                    if (error.message.includes('relation') || error.message.includes('does not exist')) {
                        log('‚ö†Ô∏è  TABLE MISSING: You need to create the households table in Supabase!', 'error');
                    }
                } else {
                    log('‚úÖ households table exists', 'success');
                }
            } catch (error) {
                log('‚ùå households table error: ' + error.message, 'error');
            }

            // Check pantry_items table
            try {
                const { data, error } = await supabase
                    .from('pantry_items')
                    .select('count')
                    .limit(1);

                if (error) {
                    log('‚ùå pantry_items table: ' + error.message, 'error');
                    if (error.message.includes('relation') || error.message.includes('does not exist')) {
                        log('‚ö†Ô∏è  TABLE MISSING: You need to create the pantry_items table in Supabase!', 'error');
                    }
                } else {
                    log('‚úÖ pantry_items table exists', 'success');
                }
            } catch (error) {
                log('‚ùå pantry_items table error: ' + error.message, 'error');
            }

            log('');
            log('=================================', 'info');
            log('Diagnostics complete!', 'success');
            log('=================================', 'info');
        }

        // Run diagnostics when page loads
        runDiagnostics();
    </script>
</body>
</html>
